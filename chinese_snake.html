<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä¸­å¼è´ªåƒè›‡</title>
  <style>
    :root {
      --red: #b00b0b;
      --gold: #e0c068;
      --ink: #1a1a1a;
      --jade: #1f8a63;
      --rice: #fdf7e5;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at 20% 20%, rgba(224, 192, 104, 0.15), transparent 35%),
        radial-gradient(circle at 80% 30%, rgba(31, 138, 99, 0.12), transparent 30%),
        radial-gradient(circle at 50% 70%, rgba(176, 11, 11, 0.18), transparent 40%),
        #0e0b0b;
      font-family: "Noto Serif SC", "STKaiti", serif;
      color: var(--gold);
    }

    .paper {
      position: relative;
      background: linear-gradient(135deg, rgba(224, 192, 104, 0.08), rgba(31, 138, 99, 0.12)),
        radial-gradient(circle at 10% 10%, rgba(255, 255, 255, 0.12), transparent 40%),
        rgba(20, 20, 20, 0.85);
      border: 2px solid var(--gold);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45), inset 0 0 0 1px rgba(255, 255, 255, 0.05);
      border-radius: 18px;
      padding: 18px 20px 16px;
      width: min(92vw, 720px);
    }

    .paper::before,
    .paper::after {
      content: "";
      position: absolute;
      inset: 10px;
      border: 1px dashed rgba(224, 192, 104, 0.3);
      pointer-events: none;
      border-radius: 12px;
    }

    .paper::after {
      inset: 16px;
      border-style: dotted;
      opacity: 0.5;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
    }

    .title {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .seal {
      width: 52px;
      height: 52px;
      background: var(--red);
      border-radius: 8px;
      color: var(--rice);
      display: grid;
      place-items: center;
      font-weight: 700;
      letter-spacing: 2px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.35), inset 0 0 0 2px rgba(255, 255, 255, 0.08);
    }

    h1 {
      margin: 0;
      font-size: clamp(20px, 3vw, 28px);
      letter-spacing: 2px;
    }

    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    button {
      padding: 8px 14px;
      border: 1px solid var(--gold);
      background: linear-gradient(145deg, rgba(224, 192, 104, 0.25), rgba(31, 138, 99, 0.25));
      color: var(--rice);
      font-weight: 600;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.12s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35);
    }

    button:active {
      transform: translateY(1px);
    }

    .hud {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: var(--gold);
      margin-bottom: 12px;
      font-size: 15px;
    }

    .stat {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(224, 192, 104, 0.08);
      border: 1px solid rgba(224, 192, 104, 0.3);
    }

    .legend {
      font-size: 13px;
      color: rgba(250, 235, 200, 0.9);
    }

    canvas {
      display: block;
      width: 100%;
      height: auto;
      border-radius: 12px;
      background: radial-gradient(circle at 25% 25%, rgba(224, 192, 104, 0.05), transparent 30%),
        radial-gradient(circle at 75% 65%, rgba(31, 138, 99, 0.08), transparent 25%),
        linear-gradient(135deg, rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0.92));
      border: 2px solid rgba(224, 192, 104, 0.4);
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
    }

    .footer {
      margin-top: 12px;
      font-size: 13px;
      color: rgba(255, 246, 220, 0.85);
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .footer strong {
      color: var(--gold);
    }
  </style>
</head>
<body>
  <div class="paper">
    <header>
      <div class="title">
        <div class="seal">ç¥¥é¾™</div>
        <div>
          <h1>ä¸­å¼è´ªåƒè›‡ Â· é‡‘ç‰æ»¡å ‚</h1>
          <div class="legend">æ–¹å‘é”®æ“æ§ï¼Œå“å°ã€Œç‰ç±³ç³•ã€ç§¯ç´¯ç¦æ°”</div>
        </div>
      </div>
      <div class="controls">
        <button id="start">å¼€å±€</button>
        <button id="pause">æš‚åœ</button>
        <button id="restart">é‡æ¥</button>
      </div>
    </header>

    <div class="hud">
      <div class="stat">å½“å‰å¾—åˆ†ï¼š<span id="score">0</span></div>
      <div class="stat">æœ€é«˜åˆ†ï¼š<span id="best">0</span></div>
      <div class="stat">é€Ÿåº¦ï¼š<span id="speed">ä¸­</span></div>
    </div>

    <canvas id="board" width="620" height="620" aria-label="ä¸­å¼è´ªåƒè›‡æ£‹ç›˜"></canvas>

    <div class="footer">
      <div>ğŸ é¿å¼€è‡ªå·±çš„èº«èº¯ä¸è¾¹ç•Œï¼Œåƒåˆ° <strong>ç‰ç±³ç³•</strong> å³å¯åŠ é•¿å¹¶åŠ å¿«ã€‚</div>
      <div>ğŸ‹ çµæ„Ÿæ¥è‡ªä¸­å›½çº¢ä¸ç¼‚ä¸çº¹æ ·ï¼Œæ„¿å›å·¦å³é€¢æºã€‚</div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("board");
    const ctx = canvas.getContext("2d");
    const gridSize = 20;
    const cells = canvas.width / gridSize;

    const scoreEl = document.getElementById("score");
    const bestEl = document.getElementById("best");
    const speedEl = document.getElementById("speed");
    const startBtn = document.getElementById("start");
    const pauseBtn = document.getElementById("pause");
    const restartBtn = document.getElementById("restart");

    let snake, direction, food, loopId, isRunning, score, speedLevel;

    const speedMap = [220, 180, 140, 110, 90];
    const speedName = ["æ‚ ç„¶", "å¹³ç¨³", "ä¸­", "è¿…æ·", "ç–¾é£"];

    function initGame() {
      snake = [
        { x: 8, y: 15 },
        { x: 7, y: 15 },
        { x: 6, y: 15 }
      ];
      direction = { x: 1, y: 0 };
      score = 0;
      speedLevel = 2;
      isRunning = false;
      food = randomFood();
      updateHUD();
      drawScene();
    }

    function randomFood() {
      let pos;
      do {
        pos = {
          x: Math.floor(Math.random() * cells),
          y: Math.floor(Math.random() * cells)
        };
      } while (snake.some((s) => s.x === pos.x && s.y === pos.y));
      return pos;
    }

    function updateHUD() {
      scoreEl.textContent = score;
      const best = Math.max(score, Number(localStorage.getItem("snakeBest") || 0));
      bestEl.textContent = best;
      localStorage.setItem("snakeBest", best);
      speedEl.textContent = speedName[speedLevel];
    }

    function drawGrid() {
      ctx.strokeStyle = "rgba(224, 192, 104, 0.05)";
      ctx.lineWidth = 1;
      for (let i = 0; i <= cells; i++) {
        ctx.beginPath();
        ctx.moveTo(i * gridSize, 0);
        ctx.lineTo(i * gridSize, canvas.height);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(0, i * gridSize);
        ctx.lineTo(canvas.width, i * gridSize);
        ctx.stroke();
      }
    }

    function drawSnake() {
      snake.forEach((segment, index) => {
        const gradient = ctx.createLinearGradient(
          segment.x * gridSize,
          segment.y * gridSize,
          (segment.x + 1) * gridSize,
          (segment.y + 1) * gridSize
        );
        gradient.addColorStop(0, "rgba(224, 192, 104, 0.92)");
        gradient.addColorStop(1, "rgba(176, 11, 11, 0.85)");
        ctx.fillStyle = gradient;
        ctx.fillRect(segment.x * gridSize + 2, segment.y * gridSize + 2, gridSize - 4, gridSize - 4);

        // ç»˜åˆ¶é¾™é³çº¹ç†
        ctx.strokeStyle = "rgba(0, 0, 0, 0.18)";
        ctx.lineWidth = 1.2;
        ctx.beginPath();
        ctx.arc(
          segment.x * gridSize + gridSize / 2,
          segment.y * gridSize + gridSize / 2,
          gridSize / 3,
          Math.PI / 6,
          (5 * Math.PI) / 3
        );
        ctx.stroke();

        // å¤´éƒ¨ç‚¹ç›
        if (index === 0) {
          ctx.fillStyle = "#111";
          const eyeOffset = gridSize / 4;
          ctx.beginPath();
          ctx.arc(segment.x * gridSize + eyeOffset, segment.y * gridSize + eyeOffset, 2.3, 0, Math.PI * 2);
          ctx.arc(segment.x * gridSize + gridSize - eyeOffset, segment.y * gridSize + eyeOffset, 2.3, 0, Math.PI * 2);
          ctx.fill();
        }
      });
    }

    function drawFood() {
      const x = food.x * gridSize;
      const y = food.y * gridSize;
      ctx.save();
      ctx.translate(x + gridSize / 2, y + gridSize / 2);
      ctx.fillStyle = "rgba(224, 192, 104, 0.95)";
      ctx.beginPath();
      ctx.arc(0, 0, gridSize / 2.3, 0, Math.PI * 2);
      ctx.fill();

      ctx.strokeStyle = "rgba(176, 11, 11, 0.9)";
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.arc(0, 0, gridSize / 3, 0, Math.PI * 2);
      ctx.stroke();

      ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
      ctx.font = "bold 12px 'Noto Serif SC'";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("ç¦", 0, 0);
      ctx.restore();
    }

    function drawBackdropText() {
      ctx.save();
      ctx.globalAlpha = 0.08;
      ctx.fillStyle = "#f2d8a7";
      ctx.font = "600 120px 'Noto Serif SC'";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.translate(canvas.width / 2, canvas.height / 2);
      ctx.rotate(-Math.PI / 12);
      ctx.fillText("ç¥¥é¾™çº³ç¦", 0, 0);
      ctx.restore();
    }

    function drawScene() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBackdropText();
      drawGrid();
      drawFood();
      drawSnake();
    }

    function step() {
      if (!isRunning) return;
      const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };

      // è¾¹ç•Œæ£€æµ‹
      if (head.x < 0 || head.x >= cells || head.y < 0 || head.y >= cells) {
        return gameOver();
      }

      // èº«ä½“ç¢°æ’
      if (snake.some((seg) => seg.x === head.x && seg.y === head.y)) {
        return gameOver();
      }

      snake.unshift(head);
      if (head.x === food.x && head.y === food.y) {
        score += 5;
        speedLevel = Math.min(speedMap.length - 1, 2 + Math.floor(score / 25));
        food = randomFood();
        updateHUD();
      } else {
        snake.pop();
      }

      drawScene();
    }

    function gameOver() {
      isRunning = false;
      clearInterval(loopId);
      ctx.save();
      ctx.fillStyle = "rgba(0, 0, 0, 0.55)";
      ctx.fillRect(0, canvas.height / 2 - 60, canvas.width, 120);
      ctx.fillStyle = "#fceccb";
      ctx.font = "700 32px 'Noto Serif SC'";
      ctx.textAlign = "center";
      ctx.fillText("æƒœç¦å†æ¥", canvas.width / 2, canvas.height / 2 - 10);
      ctx.font = "16px 'Noto Serif SC'";
      ctx.fillText("æŒ‰ç©ºæ ¼æˆ–ç‚¹å‡»ã€é‡æ¥ã€é‡å¯", canvas.width / 2, canvas.height / 2 + 26);
      ctx.restore();
    }

    function startLoop() {
      if (isRunning) return;
      isRunning = true;
      clearInterval(loopId);
      loopId = setInterval(step, speedMap[speedLevel]);
    }

    function pauseLoop() {
      isRunning = false;
      clearInterval(loopId);
    }

    function restart() {
      pauseLoop();
      initGame();
    }

    function handleKey(e) {
      const key = e.key;
      if (key === "ArrowUp" && direction.y !== 1) direction = { x: 0, y: -1 };
      else if (key === "ArrowDown" && direction.y !== -1) direction = { x: 0, y: 1 };
      else if (key === "ArrowLeft" && direction.x !== 1) direction = { x: -1, y: 0 };
      else if (key === "ArrowRight" && direction.x !== -1) direction = { x: 1, y: 0 };
      else if (key === " ") {
        if (isRunning) pauseLoop();
        else startLoop();
      }
    }

    startBtn.addEventListener("click", startLoop);
    pauseBtn.addEventListener("click", pauseLoop);
    restartBtn.addEventListener("click", restart);
    document.addEventListener("keydown", handleKey);

    initGame();
  </script>
</body>
</html>
